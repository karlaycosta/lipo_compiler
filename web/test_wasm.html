<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste WebAssembly</title>
</head>
<body>
    <h1>Teste de WebAssembly</h1>
    <div id="status">Carregando...</div>
    <div id="output"></div>

    <script type="module">
        const statusEl = document.getElementById('status');
        const outputEl = document.getElementById('output');

        async function testWasm() {
            try {
                statusEl.textContent = 'Testando suporte a WebAssembly...';
                
                if (typeof WebAssembly === 'undefined') {
                    throw new Error('WebAssembly não suportado');
                }
                
                statusEl.textContent = 'Carregando módulo...';
                
                // Testar fetch do arquivo .wasm
                const response = await fetch('./main.wasm');
                if (!response.ok) {
                    throw new Error(`Erro ao carregar main.wasm: ${response.status}`);
                }
                
                statusEl.textContent = 'Carregando main.mjs...';
                
                // Testar carregamento do módulo JS
                const { compileStreaming } = await import('./main.mjs');
                
                statusEl.textContent = 'Compilando WebAssembly...';
                
                // Recriar a requisição para o WebAssembly
                const wasmResponse = fetch('./main.wasm');
                const compiledApp = await compileStreaming(wasmResponse);
                
                statusEl.textContent = 'Instanciando...';
                const instantiatedApp = await compiledApp.instantiate();
                
                statusEl.textContent = '✅ WebAssembly funcionando!';
                outputEl.innerHTML = '<p>Módulo WebAssembly carregado com sucesso!</p>';
                
                // Tentar executar main
                try {
                    instantiatedApp.invokeMain();
                    outputEl.innerHTML += '<p>Main executado com sucesso!</p>';
                } catch (e) {
                    outputEl.innerHTML += `<p>Erro ao executar main: ${e.message}</p>`;
                }
                
            } catch (error) {
                statusEl.textContent = '❌ Erro: ' + error.message;
                outputEl.innerHTML = `<pre>${error.stack}</pre>`;
            }
        }

        testWasm();
    </script>
</body>
</html>
